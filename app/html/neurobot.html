<!DOCTYPE html>
<html>


<!-- Mirrored from logushotel.ru/neurobot.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 15 Feb 2026 21:03:34 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Telegram –±–æ—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –≥–æ—Å—Ç—è–º–∏ –æ—Ç–µ–ª—è.">
    <link rel="stylesheet" href="assets/template/css/main.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.2.7/purify.min.js"></script>
</head>

<style>
.kebab {
    cursor: pointer;
    position: absolute;
    display: inline-block;
    box-sizing: border-box;
    top: 90px;
    right: 30px;
}

.kebab figure {
    width: 6px;
    height: 6px;
    border-radius: 5px;
    background: #977138;
    margin: 3px 0;
}

.kebab .middle {
    transition: all 0.25s cubic-bezier(.72, 1.2, .71, .72);
    transform: scale(1);
    position: relative;
    box-shadow: 0 0.1px 0.1px 0 rgba(0, 0, 0, 0.16), 0 0.1px 0.3px 0 rgba(0, 0, 0, 0.12);
    -webkit-filter: blur(.1px);
    filter: blur(.1px);
}
.kebab .middle.active {
    transform: scale(4.5);
    transition: all 0.25s cubic-bezier(.32, 2.04, .85, .54);
    box-shadow: 0 0.1px 0.1px 0 rgba(0, 0, 0, 0.16), 0 0.1px 0.3px 0 rgba(0, 0, 0, 0.12);
}

.kebab .cross {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    margin-top: -1px;
    font-family: 'Nunito', sans-serif;
    color: #d9d9d9;
    transition: all 0.2s cubic-bezier(.72, 1.2, .71, .72);
    font-size: 22px;
    user-select: none;
}
.kebab .cross.active {
    transform: translate(-50%, -50%) scale(1);
    transition: all 0.15s cubic-bezier(.32, 2.04, .85, .54);
}

.kebab h1,
.kebab a,
.kebab li {
    font-family: Roboto, sans-serif;
}
.kebab a,
.kebab li {
    color: #ffffff;
    text-decoration: none;
}

.kebab .nav {
    margin-left: 20%;
}
.kebab .nav > li {
    display: inline-block;
    padding: 1em 18px;
    cursor: pointer;
}
.kebab .nav > li:hover {
    background: #ebebeb;
}

.kebab .dropdown {
    z-index: 9999;
    position: absolute;
    right: 0;
    top: 3em;
    transition: all 0.25s ease-out;
    transform: scale(0);
    transform-origin: 100% 0;
    box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.16), 0 2px 8px 0 rgba(0, 0, 0, 0.12);
    background-color: transparent;
    border-radius: 10px; 
}
.kebab .dropdown li {
    display: block;
    width: 100%;
}
.kebab .dropdown li a {
    width: 100%;
    padding: 1em 18px;
    display: inline-block;
    white-space: pre;
    box-sizing: border-box;
}
.kebab .dropdown li a:hover {
    background: #a8a195;
    border-radius: 10px;
}

.kebab .dropdown.active {
    padding: 0;
    transform: scale(1);
    transition: all 0.25s cubic-bezier(.5, 1.8, .9, .8);
    background-color: #9a8a71;
    border-radius: 10px;
}

.kebab .follow {
    overflow: hidden;
    width: 42px;
    height: 42px;
    border-radius: 50px;
    background: #03A9F4;
    display: block;
    margin: 300px auto 0;
    white-space: nowrap;
    padding: 13px;
    box-sizing: border-box;
    color: white;
    transition: all 0.2s ease;
    font-family: Roboto, sans-serif;
    text-decoration: none;
    box-shadow: 0 5px 6px 0 rgba(0, 0, 0, 0.2);
}
.kebab .follow i {
    margin-right: 20px;
    transition: margin-right 0.2s ease;
}
.kebab .follow:hover {
    width: 134px;
}
.kebab .follow:hover i {
    margin-right: 10px;
}

@media screen and (max-width: 800px) {
    .kebab .follow {
        margin: 400px auto 0;
    }
}

</style>



<body>
    <div id="neuroBody">
        <div id="chat-element">
            <div class="kebab">
                    <figure></figure>
                    <figure class="middle"></figure>
                    <p class="cross">x</p>
                    <figure></figure>
                    <ul class="dropdown">
                        <li id="clear-history-btn"><a href="javascript:void(0)">–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞</a></li>
                        
                        <!-- <li><button class="kebab-row" id="clear-history-btn">–û—á–∏—Å—Ç–∏—Ç—å  –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞</button></li> -->
                    </ul>
            </div>
            <div class="dynamic-island"></div>
            <div id="grey-area">
                
        
                
                

                <div id="chat-log" class="chat-log"></div>
                <div class="typing-area" id="typing-area">
                    <input autofocus="" id="chat-message-input" type="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ">
                    <i id="chat-message-send" class="bi bi-send"></i>
                </div>
            </div>
        </div>
    </div>

    <script>
        const chatLog = document.getElementById('chat-log');
        // –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —á–∞—Ç–∞:
        // const chatContainer = document.getElementById('chat-container');
        // const closeChat = document.getElementById('close-chat');
        const MAX_HISTORY = 15;          // —Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ –±–æ–ª–µ–µ 30 —Å–æ–æ–±—â–µ–Ω–∏–π
        let chatSocket = null;
        let isChatOpen = false;
        const GREETING_HTML = '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ.<br>–í–∞—Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ù–∏–∫–∞, –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –æ—Ç–µ–ª—è Logus AI Resort! –ó–∞–¥–∞–π—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –≤–æ–ø—Ä–æ—Å ü§ó';


        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 3;
        const reconnectDelay = 3000; // 3 —Å–µ–∫—É–Ω–¥—ã

        // Heartbeat (anti-idle)
        const HEARTBEAT_MS = 30000;          // –∫–∞–∫ —á–∞—Å—Ç–æ —Å–ª–∞—Ç—å "ping"
        const WATCHDOG_MS = 1800000;          // —Ç–µ—Ä–ø–µ–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è "pong"
        let heartbeatTimer = null;
        let watchdogTimer = null;
        let lastPongTs = Date.now();

        // –•—Ä–∞–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π "–Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π" —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
        let pendingMessage = null;

        // –•—Ä–∞–Ω–∏–º –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
        let messageHistory = [];

        // -------------------- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ --------------------

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/—Å–æ–∑–¥–∞–Ω–∏—è ¬´–µ–¥–∏–Ω–æ–≥–æ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è¬ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏)
        function setReconnectSystemMessage(text) {
            // –ò—â–µ–º —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π DOM-—ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ç–∞–∫–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            let sysMsg = document.getElementById('reconnect-system-message');

            if (!sysMsg) {
                // –ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü —á–∞—Ç–∞
                sysMsg = document.createElement('div');
                sysMsg.id = 'reconnect-system-message';
                sysMsg.className = 'message system-message';
                sysMsg.innerHTML = `
                <div class="message-bubble">
                    <p class="message-p">${text}</p>
                </div>`;
                chatLog.appendChild(sysMsg);
            } else {
                // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —É–∂–µ –µ—Å—Ç—å ‚Äî –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
                sysMsg.querySelector('.message-p').textContent = text;
            }

            // –°–∫—Ä–æ–ª–ª–∏–º —á–∞—Ç –≤–Ω–∏–∑, —á—Ç–æ–±—ã —Å–æ–æ–±—â–µ–Ω–∏–µ –±—ã–ª–æ –≤–∏–¥–Ω–æ
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        function resetChatToGreeting() {
            messageHistory = [{ message: GREETING_HTML, sender: 'ai' }];
            localStorage.setItem('messageHistory', JSON.stringify(messageHistory));
            updateChatLog();
        }

        function startHeartbeat() {
            stopHeartbeat();

            // 1) –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —à–ª—ë–º "ping"
            heartbeatTimer = setInterval(() => {
                if (chatSocket && chatSocket.readyState === WebSocket.OPEN) {
                    try {
                        chatSocket.send(JSON.stringify({ type: 'ping', ts: Date.now() }));
                    } catch (e) {
                        console.warn('Heartbeat send failed:', e);
                    }
                }
            }, HEARTBEAT_MS);

            // 2) —Å—Ç–æ—Ä–æ–∂: –µ—Å–ª–∏ –¥–∞–≤–Ω–æ –Ω–µ –±—ã–ª–æ "pong" ‚Äî —Å—á–∏—Ç–∞–µ–º —Ç–∞–π–º–∞—É—Ç–æ–º –∏ –Ω–∞—Å–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–∫–µ—Ç
            watchdogTimer = setInterval(() => {
                const silence = Date.now() - lastPongTs;
                if (silence > WATCHDOG_MS) {
                    console.warn('Watchdog: no pong for', silence, 'ms ‚Äî closing socket to trigger reconnect');
                    try { chatSocket && chatSocket.close(); } catch (_) { }
                }
            }, 1000);
        }
        function stopHeartbeat() {
            if (heartbeatTimer) { clearInterval(heartbeatTimer); heartbeatTimer = null; }
            if (watchdogTimer) { clearInterval(watchdogTimer); watchdogTimer = null; }
        }

        function updateLastAiMessageInDom(newText) {
            const lastAiMessages = chatLog.querySelectorAll('.message.ai-message');
            if (!lastAiMessages.length) return;

            const lastAi = lastAiMessages[lastAiMessages.length - 1];
            const bubble = lastAi.querySelector('.message-bubble');
            if (!bubble) return;

            // –ë–µ—Ä—ë–º —É–∂–µ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏, —á—Ç–æ–±—ã –Ω–µ "—Å–Ω–µ—Å—Ç–∏" –∏—Ö
            const imagesHtml = bubble.querySelector('.image-grid')?.outerHTML || '';
            const textHtml = md2html(makeLinksClickable(newText));

            // –†–∏—Å—É–µ–º: –°–ù–ê–ß–ê–õ–ê —Ç–µ–∫—Å—Ç, –∑–∞—Ç–µ–º (–µ—Å–ª–∏ –±—ã–ª–∏) –∫–∞—Ä—Ç–∏–Ω–∫–∏
            bubble.innerHTML = textHtml + imagesHtml;
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        // –û–±—ã—á–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–µ –ø—Ä–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ) - –ø–æ –∂–µ–ª–∞–Ω–∏—é
        function addSystemMessage(text) {
            messageHistory.push({ message: text, sender: 'system' });
            localStorage.setItem('messageHistory', JSON.stringify(messageHistory));
            updateChatLog();
        }

        function makeLinksClickable(text) {

            const urlRegex = /(\[([^\]]+)\]\((https?:\/\/[^\s]+)\))|(https?:\/\/[^\s]+)/g;

            return text.replace(urlRegex, function (match, fullLink, linkText, linkUrl, plainUrl) {
                if (fullLink) {

                    return `<a href="${linkUrl}" target="_blank" rel="noopener noreferrer" style="color: #977138;text-decoration: underline;">${linkText}</a>`;
                } else if (plainUrl) {

                    const cleanUrl = plainUrl.replace(/[)\].,;'"`]+$/, '');
                    const trailingPunctuation = plainUrl.slice(cleanUrl.length);
                    return `<a href="${cleanUrl}" target="_blank" rel="noopener noreferrer" style="color: #977138;text-decoration: underline;">—Å—Å—ã–ª–∫–∞</a>${trailingPunctuation}`;
                }
                return match;
            });
        }
        function md2html(mdText) {
            // breaks:true   ‚Üí \n ‚Üí <br>, –∫–∞–∫ –≤ Telegram
            // mangle:false  ‚Üí –æ—Ç–∫–ª—é—á–∞–µ–º &amp;#123; –≤ –∞–¥—Ä–µ—Å–∞—Ö
            const rawHtml = marked.parse(mdText, { breaks: false, mangle: false, headerIds: false });
            return DOMPurify.sanitize(rawHtml);          // –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
        }
        function imagesToHtml(images) {
            if (!Array.isArray(images) || images.length === 0) return '';
            const imgs = images.map(img => {
                const mime = img.mime || 'image/png';
                const fn = img.filename || 'image';
                const b64 = img.b64 || '';
                const src = `data:${mime};base64,${b64}`;
                return `<img class="chat-image" src="${src}" alt="${fn}" loading="lazy">`;
            }).join('');
            return `<div class="image-grid">${imgs}</div>`;
        }
        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —á–∞—Ç–∞
        function updateChatLog() {
            if (messageHistory.length > MAX_HISTORY) {
                messageHistory = messageHistory.slice(-MAX_HISTORY);
                localStorage.setItem('messageHistory', JSON.stringify(messageHistory));
            }

            chatLog.innerHTML = '';
            messageHistory.forEach(item => {
                let senderClass = '';
                if (item.sender === 'ai') {
                    senderClass = 'ai';
                } else if (item.sender === 'user') {
                    senderClass = 'human';
                } else if (item.sender === 'system') {
                    senderClass = 'system';
                } else {
                    senderClass = 'unknown';
                }


                let text = item.message ? String(item.message) : '';
                text = makeLinksClickable(text);
                text = md2html(text);

                const imgs = imagesToHtml(item.images);

                chatLog.innerHTML += `
                <div class="message ${senderClass}-message">
                    <div class="message-bubble">
                        ${text}${imgs}
                    </div>
                </div>`;
            });
            chatLog.scrollTop = chatLog.scrollHeight;
        }


        // -------------------- –õ–æ–≥–∏–∫–∞ WebSocket --------------------

        // –ó–∞–ø—É—Å–∫ WebSocket-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function initWebSocket() {
            chatSocket = new WebSocket('wss://neurobooking.online/ws/chatbot/freshwind-test/v2');

            chatSocket.onopen = function (e) {
                console.log('WebSocket connected');
                lastPongTs = Date.now();
                startHeartbeat();

                reconnectAttempts = 0;
                // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî –æ—Ç–ø—Ä–∞–≤–∏–º
                if (pendingMessage) {
                    sendMessageToServer(pendingMessage);
                    pendingMessage = null;
                }

            };

            chatSocket.onmessage = function (e) {
                const data = JSON.parse(e.data);

                if (data.type === 'pong') {
                    lastPongTs = Date.now();
                    console.log('Received pong');
                    return;
                }

                if (data.type === 'start') {
                    messageHistory.push({ message: '–ü—Ä–æ—á–∏—Ç–∞–Ω–æ', sender: 'system' });
                    updateChatLog();
                    return;
                }

                if (data.type === 'stop') {
                    // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ ‚Äî –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å "–ü–µ—á–∞—Ç–∞–µ—Ç...", –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å
                    return;
                }

                if (data.type === 'image' && Array.isArray(data.images)) {
                    console.log('images payload count =', data.images.length);

                    // –°–Ω–∏–º–∞–µ–º "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ/–ü–µ—á–∞—Ç–∞–µ—Ç...", –µ—Å–ª–∏ –≤–∏—Å–∏—Ç –≤ —Ö–≤–æ—Å—Ç–µ
                    while (
                        messageHistory.length > 0 &&
                        messageHistory[messageHistory.length - 1].sender === 'system' &&
                        (
                            messageHistory[messageHistory.length - 1].message === '–ü–µ—á–∞—Ç–∞–µ—Ç...' ||
                            messageHistory[messageHistory.length - 1].message === '–ü—Ä–æ—á–∏—Ç–∞–Ω–æ'
                        )
                    ) {
                        messageHistory.pop();
                    }

                    // –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç ‚Äî AI, –ø—Ä–æ—Å—Ç–æ –î–û–ë–ê–í–õ–Ø–ï–ú –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∫ –Ω–µ–º—É
                    const lastIdx = messageHistory.length - 1;
                    if (lastIdx >= 0 && messageHistory[lastIdx].sender === 'ai') {
                        const last = messageHistory[lastIdx];
                        last.images = (last.images || []).concat(data.images);
                    } else {
                        // –ò–Ω–∞—á–µ —Å–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–µ AI‚Äë—Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø—Ä–∏—à–ª–∏ –ø–µ—Ä–≤—ã–º–∏)
                        messageHistory.push({ sender: 'ai', message: '', images: data.images });
                    }

                    localStorage.setItem('messageHistory', JSON.stringify(messageHistory));
                    updateChatLog();
                    return;
                }


                if (data.sender === 'ai') {
                    // –£–¥–∞–ª—è–µ–º "–ü–µ—á–∞—Ç–∞–µ—Ç..." / "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ", –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –æ—Å—Ç–∞–ª–∏—Å—å
                    while (
                        messageHistory.length > 0 &&
                        messageHistory[messageHistory.length - 1].sender === 'system' &&
                        (
                            messageHistory[messageHistory.length - 1].message === '–ü–µ—á–∞—Ç–∞–µ—Ç...' ||
                            messageHistory[messageHistory.length - 1].message === '–ü—Ä–æ—á–∏—Ç–∞–Ω–æ'
                        )
                    ) {
                        messageHistory.pop();
                    }

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º (—Å—Ç—Ä–∏–º–∏–Ω–≥) –∏–ª–∏ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
                    const lastIndex = messageHistory.length - 1;
                    if (lastIndex >= 0 && messageHistory[lastIndex].sender === 'ai') {
                        // (–∞) –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ / —Å—Ç—Ä–∏–º–∏–Ω–≥ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ AI-—Å–æ–æ–±—â–µ–Ω–∏—è
                        messageHistory[lastIndex].message = data.message;
                        // –µ—Å–ª–∏ –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º —á–∞–Ω–∫–µ –ø—Ä–∏—à–ª–∏ additional_kwargs ‚Äî –ø—Ä–∏–∫–ª–µ–∏–≤–∞–µ–º –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É AI-—Å–æ–æ–±—â–µ–Ω–∏—é
                        if (data.additional_kwargs) {
                            messageHistory[lastIndex].additional_kwargs = data.additional_kwargs;
                        }
                        localStorage.setItem('messageHistory', JSON.stringify(messageHistory));

                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–ª–æ–∫ –≤ DOM, –±–µ–∑ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏:
                        updateLastAiMessageInDom(data.message);

                    } else {
                        // (–±) –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç AI
                        const aiItem = { message: data.message, sender: 'ai' };
                        if (data.additional_kwargs) {
                            aiItem.additional_kwargs = data.additional_kwargs;
                        }
                        messageHistory.push(aiItem);
                        localStorage.setItem('messageHistory', JSON.stringify(messageHistory));

                        // –ú–æ–∂–Ω–æ —Å—Ä–∞–∑—É –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –±–ª–æ–∫ –≤ —á–∞—Ç (–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤—ã–∑–≤–∞—Ç—å updateChatLog()):
                        updateChatLog();
                    }
                    return;

                }


                console.log('Unknown message type/data:', data);
            };

            chatSocket.onerror = function (e) {
                console.error('WebSocket error', e);
                // –ó–∞–∫—Ä–æ–µ–º —Å–æ–∫–µ—Ç, —á—Ç–æ–±—ã onclose –≤—ã–ø–æ–ª–Ω–∏–ª –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                if (chatSocket) {
                    chatSocket.close();
                }
            };

            chatSocket.onclose = function (e) {
                console.error('WebSocket closed', e);
                setReconnectSystemMessage(
                    `–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —á–∞—Ç–±–æ—Ç—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–Ω–æ–≤–∞.`
                );
            };
        }


        // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 —Å–æ–æ–±—â–µ–Ω–∏–π –ë–ï–ó –ø–æ–ª—è images
        function getHistoryWithoutImages() {
            return messageHistory.slice(-15).map(item => {
                const cleaned = { ...item };
                if ('images' in cleaned) delete cleaned.images; // –ø—Ä–æ—Å—Ç–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∫–ª—é—á–∞
                return cleaned;
            });
        }

        // -------------------- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π --------------------

        function sendMessageToServer(message) {
            if (!chatSocket || chatSocket.readyState !== WebSocket.OPEN) {
                // –°–æ–∫–µ—Ç –Ω–µ –≥–æ—Ç–æ–≤
                pendingMessage = message; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º
                // –ü–∏—à–µ–º –≤ –µ–¥–∏–Ω–æ–µ —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ + –∫–Ω–æ–ø–∫–∞
                setReconnectSystemMessage(
                    `–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: –Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —á–∞—Ç–±–æ—Ç–æ–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–Ω–æ–≤–∞.`
                );
                return;
            }
            // –ï—Å–ª–∏ —Å–æ–∫–µ—Ç –æ—Ç–∫—Ä—ã—Ç ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
            chatSocket.send(JSON.stringify({
                'message': message,
                'history': getHistoryWithoutImages()  // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 —Å–æ–æ–±—â–µ–Ω–∏–π
            }));
        }

        // -------------------- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞ --------------------

        function setupChat() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –µ—Å—Ç—å
            if (localStorage.getItem('messageHistory')) {
                messageHistory = JSON.parse(localStorage.getItem('messageHistory'));
            } else {
                // –ï—Å–ª–∏ –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏, –¥–æ–±–∞–≤–∏–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                messageHistory.push({
                    message: GREETING_HTML,
                    sender: 'ai'
                });
                localStorage.setItem('messageHistory', JSON.stringify(messageHistory));
            }
            updateChatLog();

            // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –ø–æ WebSocket –æ–¥–∏–Ω —Ä–∞–∑
            if (!isChatOpen) {
                initWebSocket();
                isChatOpen = true;
            }

            // –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
            document.getElementById('chat-message-send').onclick = function () {
                const messageInputDom = document.getElementById('chat-message-input');
                const message = messageInputDom.value.trim();
                if (message) {
                    messageHistory.push({ message: message, sender: 'user' });
                    localStorage.setItem('messageHistory', JSON.stringify(messageHistory));
                    updateChatLog();
                    sendMessageToServer(message);
                    messageInputDom.value = '';
                }
            };

            // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ Enter
            document.getElementById('chat-message-input').addEventListener('keyup', function (event) {
                if (event.key === 'Enter') {
                    const messageInputDom = document.getElementById('chat-message-input');
                    const message = messageInputDom.value.trim();
                    if (message) {
                        messageHistory.push({ message: message, sender: 'user' });
                        localStorage.setItem('messageHistory', JSON.stringify(messageHistory));
                        updateChatLog();
                        sendMessageToServer(message);
                        messageInputDom.value = '';
                    }
                }
            });

            // NEW: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–û—á–∏—Å—Ç–∏—Ç—å¬ª
            const clearBtn = document.getElementById('clear-history-btn');
            if (clearBtn) {
                clearBtn.addEventListener('click', () => {
                    // –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Äî —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ 2 —Å—Ç—Ä–æ–∫–∏ –Ω–∏–∂–µ:
                    // if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç –∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ?')) return;
                    resetChatToGreeting();
                });
            }
        }

        // –ó–∞–ø—É—Å–∫
        setupChat();

        // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ ¬´–ó–∞–∫—Ä—ã—Ç—å —á–∞—Ç¬ª:
        // closeChat.addEventListener('click', () => {
        //     chatContainer.classList.remove('visible');
        //     if (chatSocket) {
        //         chatSocket.close();
        //     }
        // });
    </script>
    <script>
        document.getElementById('neuroBody').addEventListener('click', function (e) {
            const chat = document.getElementById('chat-element');
            const clickedInsideChat = chat.contains(e.target);
            if (!clickedInsideChat) {
                window.parent.postMessage('click', '*'); // –∑–∞–∫—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –º–∏–º–æ —á–∞—Ç–∞
            }
            });
    </script>

    <script>
        var kebab = document.querySelector('.kebab'),
            middle = document.querySelector('.middle'),
            cross = document.querySelector('.cross'),
            dropdown = document.querySelector('.dropdown');

        kebab.addEventListener('click', function () {
            middle.classList.toggle('active');
            cross.classList.toggle('active');
            dropdown.classList.toggle('active');
        })
        
    </script>

</body>


<!-- Mirrored from logushotel.ru/neurobot.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 15 Feb 2026 21:03:34 GMT -->
</html>